jQuery.fn.jRotator=function(c){function k(c,n){l=!1;clearInterval(t);p.stop().width(0);var b=g.find("div:visible"),a=b.index();n?n--:n=c?a+1<f?a+1:0:0>a-1?f-1:a-1;g.find("div").hide();var e=g.find("div").eq(n);d.find("div").removeClass("cur");d.find("div").eq(n).addClass("cur");"none"==e.css("background-image")?(a=new Image,a.onload=function(){e.css("background-image","url("+e.attr("bg")+")");b.fadeOut("slow");e.fadeIn("slow","",function(){l=!0;p.animate({width:h},m,"linear");t=setInterval(function(){k(1)}, m)})},$(a).attr("src",e.attr("bg"))):(b.fadeOut("slow"),e.fadeIn("slow","",function(){l=!0;p.animate({width:h},m,"linear");t=setInterval(function(){k(1)},m)}))}c=$.extend({pAlign:"center",thumbW:"120",thumbH:"64",nothumb:!1,timeLineColor:"#ff0000"},c);var q=$(this),b=q.find("img"),f=b.size();if(!f)return!1;var l=!0,t;b.hide();var w=$('<div class="jR"></div>'),g=$('<div class="jR-images"></div>'),p=$('<div class="jR-timeline"></div>');if(!c.nothumb)var e=$('<div class="jR-thumbs"></div>');b.each(function(){var a= $(this).attr("src"),b=$(this).attr("thumb"),b=b?b:a,d="",f=$(this).parents(":first");f.is("a")&&(d=f.attr("href"));g.append('<div bg="'+a+'" href="'+d+'"></div>');c.nothumb||e.append('<img src="'+b+'" width="'+c.thumbW+'" height="'+c.thumbH+'">')});var r=$('<div class="jR-prev"></div>'),s=$('<div class="jR-next"></div>'),b=f,d=$('<div class="jR-points">'+Array(++b).join("<div></div>")+"</div>");w.prepend(g).prepend(d).prepend(c.nothumb?"":e).prepend(r).prepend(s).prepend(p.css("background-color", c.timeLineColor));var m=7E3,h=q.width(),b=q.height(),a;d.find("div").each(function(a,b){var d=17*a;$(b).css("margin-left",d);c.nothumb||e.find("img").eq(a).css("margin-left",d)});w.add(g).add(g.find("div")).css({width:h,height:b});switch(c.pAlign){case "left":a=10;break;case "center":a=h/2-(10*f+7*(f-1))/2;break;case "right":a=h-(10*f+7*(f-1))-10}d.css({margin:b-10-10+"px 0 0 "+a+"px",width:"auto"});r.css("margin",b/2-43+"px 0 0 5px");s.css("margin",b/2-43+"px 0 0 "+(h-5-31)+"px");if(!c.nothumb){var u; switch(c.pAlign){case "left":u=1.5*a;break;case "center":u=a-c.thumbW/2;break;case "right":u=a-c.thumbW}e.css("margin",parseInt(d.css("margin-top").replace("px",""))+10+10+"px 0 0 "+u+"px")}var v=g.find(":first");a=new Image;a.onload=function(){v.css("background-image","url("+v.attr("bg")+")");v.fadeIn("slow","",function(){d.find(":first").addClass("cur");l=!0;p.animate({width:h},m,"linear");t=setInterval(function(){k(1)},m)})};$(a).attr("src",v.attr("bg"));q.prepend(w);g.find("div").click(function(){var a= $(this).attr("href");if(!a)return!1;location.href=a});q.hover(function(){r.add(s).show()},function(){r.add(s).hide()});d.find("div").click(function(){if($(this).hasClass("cur"))return!1;d.find("div").removeClass("cur");$(this).addClass("cur");k(0,$(this).index()+1)});c.nothumb||d.find("div").hover(function(){e.find("img").eq($(this).index()).fadeIn(200)},function(){e.find("img").hide()});r.click(function(){l&&k();return!1});s.click(function(){l&&k(1);return!1})};